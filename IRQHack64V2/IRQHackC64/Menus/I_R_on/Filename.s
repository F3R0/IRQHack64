TYPE_PROGRAM = 0
TYPE_CHECK_PLUGIN	= 1

PERIOD_POSITION 	
	.BYTE 0
FILENAME_ACTUAL_LENGTH 
	.BYTE 0
PLUGIN_EXTENSION_POS 
	.BYTE 0
		
; Send low in A	, high in X
CHECKFILENAME
	STA $06
	STX $07
	
	LDA #$00
	STA PERIOD_POSITION
	
	
	LDY #0
-		
	LDA ($06), Y
	BEQ ENDOFNAME
	INY			
	CMP #$2E	
	BEQ FOUNDPERIOD
	JMP - 
FOUNDPERIOD
	STY PERIOD_POSITION
	LDX #0
-	
	LDA ($06), Y
	BEQ ENDOFNAME	
	STA PLUGINNAME,X
	INX 
	INY
	JMP - 
	
ENDOFNAME	
	LDA PERIOD_POSITION
	BEQ +
	STY FILENAME_ACTUAL_LENGTH
	LDA PERIOD_POSITION
	CMP FILENAME_ACTUAL_LENGTH			; Check if the last character was period (.)
	BEQ +
	STX PLUGIN_EXTENSION_POS
	LDA #TYPE_CHECK_PLUGIN
	JMP ENDCHECKFILENAME
+
	LDA #TYPE_PROGRAM
		
ENDCHECKFILENAME	
	RTS
	
BUILDPLUGINNAME_PRG
	LDA #<PLUGINNAME
	STA $06
	LDA #>PLUGINNAME
	STA $07
	
	LDX #0
	LDY PLUGIN_EXTENSION_POS
-		
	LDA PLUGIN_PRG, X
	STA ($06), Y
	INY
	INX
	CPX #11
	BNE - 
	RTS

BUILDPLUGINNAME_BIN
	LDA #<PLUGINNAME
	STA $06
	LDA #>PLUGINNAME
	STA $07
	
	LDX #0
	LDY PLUGIN_EXTENSION_POS	
-	
	LDA PLUGIN_BIN, X
	STA ($06), Y
	INY
	INX
	CPX #11
	BNE - 
	RTS	
	
ISPRG	
.enc screen
	LDX PLUGINNAME
	CPX #$70
	BNE + 
	LDX PLUGINNAME+1
	CPX #$72
	BNE +
	LDX PLUGINNAME+2	
	CPX #$67
	BNE +	
	CLC
	RTS
+	
	SEC
	RTS
.enc none


	
PLUGINNAME
	.FILL 16

	
PLUGIN_PRG
	.TEXT "PLUGIN.PRG"
	.BYTE 0
	
PLUGIN_BIN
	.TEXT "PLUGIN.BIN"	
	.BYTE 0
